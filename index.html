<!DOCTYPE html>
<html>
<head>
<base href="https://greensofa24.github.io/life/">
<title>Conway's Game of Life</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Ubuntu&display=swap');

body {
overflow: hidden;
font-family: "Ubuntu";
font-size: 15px;
}

canvas {
position: absolute;
top: 0px;
left: 0px;
}

hr {
visibility: hidden;
margin-top: 4px;
margin-bottom: 0px;
}

button {
font-family: inherit;
}

input {
width: 61px;
}

.advanced {
float: right;
visibility: hidden;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div></div>

<hr id="spacer">
<label>Width: </label>
<input id="width" value=40 type="number" min=0 max=100>
<button style="float: right;" onclick="for (let e of document.getElementsByClassName('advanced')) {
e.style.visibility = visible ? 'hidden' : 'visible';
}
document.getElementById('rulesetDiv').style.visibility = visible ? 'hidden' : 'visible';
document.getElementById('arrow').innerText = visible ? '▼' : '▲';
visible = !visible;">Advanced <span id="arrow" style="font-size:12px;">▼</span></button>
<hr>
<label>Height: </label>
<input id="height" value=40 type="number" min=0 max=100>
<div class="advanced allRules">
<label>Ruleset: </label>
<select id="ruleset" onchange="
for (let e of document.getElementsByClassName('advanced')) {
e.style.display = this.value == 'generations' ? '' : 'none';
}
for (let e of document.getElementsByClassName('allRules')) {
e.style.display = '';
}">
<option value="generations" selected>Life-like/Generations</option>
<option value="wireWorld">WireWorld</option>
<option value="neumann">29-state rule</option>
</select>
</div>
<input style="visibility: hidden;">
<hr>
<label>Tickspeed: </label>
<input id="tickspeed" value=10 type="number" min=0 max=5000>
<label>tps</label>
<div class="advanced allRules">
<label>Cell Size: </label>
<input id="cellSize" value=10 type="number" min=0 max=100>
</div>
<hr>

<button onclick="
document.getElementById('birth').value = '3';
document.getElementById('survival').value = '23';
document.getElementById('states').value = 2;
document.getElementById('update').click();
">Standard</button>
<button onclick="
document.getElementById('birth').value = '36';
document.getElementById('survival').value = '23';
document.getElementById('states').value = 2;
document.getElementById('update').click();
">HighLife</button>
<button onclick="
document.getElementById('birth').value = '1357';
document.getElementById('survival').value = '1357';
document.getElementById('states').value = 2;
document.getElementById('update').click();
">Replicator</button>

<div class="advanced">
<label>Birth Condition: </label>
<input id="birth" value="3" onkeydown="
if (!(/\d/.test(event.key) || event.key == 'Backspace') || this.value.includes(event.key)) {
event.preventDefault();
} else {
this.value = this.value.split('').sort().join('');
}
">
</div>
<hr>

<button id="update" onclick="
width = parseInt(document.getElementById('width').value);
height = parseInt(document.getElementById('height').value);
cellSize = parseFloat(document.getElementById('cellSize').value);
tickspeed = parseInt(document.getElementById('tickspeed').value);
birth = document.getElementById('birth').value.split('').map(e => parseInt(e));
survival = document.getElementById('survival').value.split('').map(e => parseInt(e));
birthChance = parseFloat(document.getElementById('birthChance').value);
nbhType = document.getElementById('nbhType').value;
ruleset = document.getElementById('ruleset').value;
states = ruleset == 'wireWorld' ? 4 : ruleset == 'neumann' ? 29 : parseInt(document.getElementById('states').value);
setupGrid();
clearGrid();
">Update</button>

<div class="advanced">
<label>Survival Condition: </label>
<input id="survival" value="23" onkeydown="
if (!(/\d/.test(event.key) || event.key == 'Backspace') || this.value.includes(event.key)) {
event.preventDefault();
} else {
this.value = this.value.split('').sort().join('');
}
">
</div>
<hr>

<div class="advanced">
<label>States: </label>
<input id="states" value=2 type="number" min=2>
</div>
<input style="visibility: hidden;">
<hr>

<div class="advanced">
<label>Spontaneous Birth Chance: </label>
<input id="birthChance" value=0 type="number" min=0 max=1>
</div>
<input style="visibility: hidden;">
<hr>

<div class="advanced">
<label>Neighbourhood Size: </label>
<input id="nbhSize" value=1 type="number" min=1 max=10>
</div>
<input style="visibility: hidden;">
<hr>

<div class="advanced">
<label>Neighbourhood Type: </label>
<select id="nbhType">
<option value="moore" selected>Moore</option>
<option value="neumann">von Neumann</option>
</select>
</div>
<input style="visibility: hidden;">
<hr>

<div class="advanced allRules">
<button onclick="navigator.clipboard.writeText(JSON.stringify(grid));">Export grid state</button>
<button onclick="grid = JSON.parse(prompt('Paste JSON'));">Import grid state</button>
</div>

<script>
canvas = document.getElementById("canvas");
ctx = canvas.getContext("2d");
canvas.width = innerWidth;
visible = false;

function hslToHex(h, s, l) {
l /= 100;
const a = s * Math.min(l, 1 - l) / 100;
const f = n => {
const k = (n + h / 30) % 12;
const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
return Math.round(255 * color).toString(16).padStart(2, '0');  
};
return `#${f(0)}${f(8)}${f(4)}`;
}

function chance(decimal) {
let rand = Math.floor(Math.random() * (1 / decimal));
return rand == 0;
}

function text(content, x, y, size, colour) {
if (!(this instanceof text)) {
return new text(content, x, y, size, colour);
}
this.x = x * 10;
this.y = y * 10;
this.size = size;
this.content = content;
this.draw = function() {
ctx.fillStyle = colour;
ctx.beginPath();
ctx.font = this.size + "px Comic Sans MS";
ctx.closePath();
ctx.fillText(this.content, this.x, this.y);
}
}

function button(x, y, width, height) {
if (!(this instanceof button)) {
return new button(x, y, width, height);
}
this.x = x * 10;
this.y = y * 10;
this.width = width * 10;
this.height = height * 10;
this.top = this.y;
this.bottom = this.y + this.height;
this.left = this.x;
this.right = this.x + this.width;
this.state = 0;
this.draw = function() {
ctx.lineWidth = 4;
ctx.strokeRect(this.x, this.y, this.width, this.height);
ctx.fillStyle = "white";
ctx.fillRect(this.x, this.y, this.width, this.height);
ctx.lineWidth = 1;
ctx.fillStyle = "black";
}
this.touching = function(object) {
if (this.bottom >= object.top && this.top <= object.bottom && this.left < object.right && this.right > object.left) {
return true;
} else {
return false;
}
}
}

let width = 40;
let height = 40;
let cellSize = 10;
let tickspeed = 10;
let birth = [3];
let survival = [2, 3];
let cellType = 1;
let states = 2;
let birthChance = 0;
//nbh means neighbourhood
let nbhSize = 1;
let nbhType = "moore";
let ruleset = "generations";
//C means colours
let wireWorldC = ["black", "blue", "red", "yellow"];
let neumann29src = ["S", "S0", "S00", "S000", "S01", "S1", "S10", "S11", "O0E", "O0N", "O0W", "O0S", "O1E", "O1N", "O1W", "O1S", "S0E", "S0N", "S0W", "S0S", "S1E", "S1N", "S1W", "S1S", "C00", "C11", "C10", "C01"];
let grid, control, controlText, clear, clearText, step, stepText, rand, randText, evolveInterval, clickedCell;
let neumann29img = [];
for (let i in neumann29src) {
let image = new Image();
image.src = neumann29src[i] + ".png";
neumann29img.push(image);
}

function setupGrid() {
canvas.height = height * cellSize + 5;
document.getElementById("spacer").style.marginTop = height * cellSize + 10 + "px";
grid = Array(height).fill().map(e => Array(width).fill(0));
control = button(width / 10 * cellSize + 1.25, 1, 4, 2);
controlText = text("Start", width / 10 * cellSize + 1.5, 2.5, 12.5, "black");
clear = button(width / 10 * cellSize + 1.25, 4, 4, 2);
clearText = text("Clear", width / 10 * cellSize + 1.5, 5.5, 12.5, "black");
step = button(width / 10 * cellSize + 6.25, 1, 4, 2);
stepText = text("Step", width / 10 * cellSize + 6.5, 2.5, 12.5, "black");
rand = button(width / 10 * cellSize + 6.25, 4, 4, 2);
randText = text("Rand", width / 10 * cellSize + 6.5, 5.5, 12.5, "black");
generation = 0;
genText = text("Generation: 0", width / 10 * cellSize + 1.125, 8, 12.5, "black");
clearInterval(evolveInterval);
clickedCell = [];
}

setupGrid();

function update() {
ctx.clearRect(0, 0, canvas.width, canvas.height);
control.draw();
controlText.draw();
clear.draw();
clearText.draw();
step.draw();
stepText.draw();
rand.draw();
randText.draw();
genText.draw();
for (let i in grid) {
for (let j in grid[i]) {
if (ruleset == "generations") {
if (grid[i][j] != 0) {
if (states > 2) {
id = grid[i][j];
phi = (1 + Math.sqrt(5)) / 2;
hue = id * phi - Math.floor(id * phi);
hue = Math.floor(hue * 256);
sat = id * 2 * phi - Math.floor(id * 2 * phi);
sat = Math.floor(sat * 50);
lit = id * 3 * phi - Math.floor(id * 3 * phi);
lit = Math.floor(lit * 50);
ctx.fillStyle = hslToHex(hue, 50 + sat, 30 + lit);
ctx.fillRect(cellSize * j + 1, cellSize * i + 1, cellSize, cellSize);
} else {
ctx.fillStyle = "black";
ctx.fillRect(cellSize * j + 1, cellSize * i + 1, cellSize, cellSize);
}
}
}
if (ruleset == "wireWorld") {
ctx.fillStyle = wireWorldC[grid[i][j]];
ctx.fillRect(cellSize * j + 1, cellSize * i + 1, cellSize, cellSize);
}
if (ruleset == "neumann") {
if (grid[i][j] != 0) {
ctx.drawImage(neumann29img[grid[i][j] - 1], cellSize * j + 1, cellSize * i + 1, cellSize, cellSize);
}
}
}
}
ctx.strokeRect(1, 1, cellSize * width, cellSize * height);
}

update();
setInterval(update, 10);

function updateGrid(event) {
if (event.clientX < cellSize * grid[0].length && event.clientY < cellSize * grid.length) {
x = Math.floor(event.clientX / cellSize);
y = Math.floor(event.clientY / cellSize);
if ([x, y].join(',') != clickedCell.join(',')) {
grid[y][x] = grid[y][x] == cellType ? 0 : cellType;
clickedCell = [x, y];
}
}
}

function evolve() {
let grid2 = [];
for (let i in grid) {
grid2.push([]);
for (let e of grid[i]) {
grid2[i].push(e);
}
}
for (let i = 0; i < height; i++) {
for (let j = 0; j < width; j++) {
let neighbours = 0;

if (nbhType == "moore") {
for (let k = -nbhSize; k <= nbhSize; k++) {
for (let l = -nbhSize; l <= nbhSize; l++) {
if (k != 0 || l != 0) {

//index needs to be in bounds
if ((k != -nbhSize || i >= nbhSize) && (l != -nbhSize || j >= nbhSize) && (k != nbhSize || i < height - nbhSize) && (l != nbhSize || j < width - nbhSize)) {
if (grid2[i + k][j + l] == 1) {
neighbours += 1;
}
}

}
}
}
}

if (nbhType == "neumann") {
for (let k = -nbhSize; k <= nbhSize; k++) {
if (k != 0) {

//index needs to be in bounds
if ((k != -nbhSize || i >= 1) && (k != nbhSize || i < height - nbhSize)) {
if (grid2[i + k][j] == 1) {
neighbours += 1;
}
}
if ((k != -nbhSize || j >= 1) && (k != nbhSize || j < height - nbhSize)) {
if (grid2[i][j + k] == 1) {
neighbours += 1;
}
}

}
}
}

if (ruleset == "generations") {
if (grid[i][j] <= 1) {
if (!survival.includes(neighbours)) {
if (states > 2 && grid[i][j] == 1) {
grid[i][j] = 2;
} else {
grid[i][j] = 0;
}
}
if (birth.includes(neighbours) && grid2[i][j] == 0) {
grid[i][j] = 1;
}
} else {
grid[i][j] += 1;
if (grid[i][j] == states) {
grid[i][j] = 0;
}
}
if (grid[i][j] == 0) {
if (chance(birthChance)) {
grid[i][j] = 1;
}
}
}

if (ruleset == "wireWorld") {
if (grid[i][j] == 1 || grid[i][j] == 2) {
grid[i][j] += 1;
} else if (grid[i][j] == 3) {
if (neighbours == 1 || neighbours == 2) {
grid[i][j] = 1;
}
}
}

if (ruleset == "neumann") {
let signal = [0, 0];

for (let k = -1; k <= 1; k++) {
if (k != 0) {
if ((k != -1 || i >= 1) && (k != 1 || i < height - 1)) {
if (grid2[i + k][j] == 15 - k) {
signal = [1, signal[1]];
}
if (grid2[i + k][j] == 23 - k) {
signal = [signal[0], 1];
}
if ((grid2[i][j] == 11 - k || grid2[i][j] == 15 - k || grid2[i][j] == 19 - k || grid2[i][j] == 23 - k) && grid2[i + k][j] >= 27) {
signal = [1, signal[1]];
}
if (grid2[i][j] >= 25 && grid2[i + k][j] == 11 - k) {
signal = [0, signal[1]];
}
}
if ((k != -1 || j >= 1) && (k != 1 || j < height - 1)) {
if (grid2[i][j + k] == 14 + k) {
signal = [1, signal[1]];
}
if (grid2[i][j + k] == 22 + k) {
signal = [signal[0], 1];
}
if ((grid2[i][j] == 10 + k || grid2[i][j] == 14 + k || grid2[i][j] == 18 + k || grid2[i][j] == 22 + k) && grid2[i][j + k] >= 27) {
signal = [1, signal[1]];
}
if (grid2[i][j] >= 25 && grid2[i][j + k] == 10 + k) {
signal = [0, signal[1]];
}
}
}
}

if (grid2[i][j] == 0 && (signal[0] || signal[1])) {
grid[i][j] = 1;
}

if (grid2[i][j] == 1) {
if (signal[0] || signal[1]) {
grid[i][j] = 6;
} else {
grid[i][j] = 2;
}
}

if (grid2[i][j] == 2) {
if (signal[0] || signal[1]) {
grid[i][j] = 5;
} else {
grid[i][j] = 3;
}
}

if (grid2[i][j] == 3) {
if (signal[0] || signal[1]) {
grid[i][j] = 11;
} else {
grid[i][j] = 4;
}
}

if (grid2[i][j] == 4) {
if (signal[0] || signal[1]) {
grid[i][j] = 10;
} else {
grid[i][j] = 9;
}
}

if (grid2[i][j] == 5) {
if (signal[0] || signal[1]) {
grid[i][j] = 17;
} else {
grid[i][j] = 12;
}
}

if (grid2[i][j] == 6) {
if (signal[0] || signal[1]) {
grid[i][j] = 8;
} else {
grid[i][j] = 7;
}
}

if (grid2[i][j] == 7) {
if (signal[0] || signal[1]) {
grid[i][j] = 19;
} else {
grid[i][j] = 18;
}
}

if (grid2[i][j] == 8) {
if (signal[0] || signal[1]) {
grid[i][j] = 25;
} else {
grid[i][j] = 20;
}
}

if (grid2[i][j] == 25) {
if (signal[0] || signal[1]) {
grid[i][j] = 26;
}
}

if (grid2[i][j] == 26) {
if (signal[0] || signal[1]) {
grid[i][j] = 28;
} else {
grid[i][j] = 27;
}
}

if (grid2[i][j] == 27) {
if (signal[0] || signal[1]) {
grid[i][j] = 26;
} else {
grid[i][j] = 25;
}
}

if (grid2[i][j] == 28) {
if (!(signal[0] || signal[1])) {
grid[i][j] = 27;
}
}

if ((((grid2[i][j] >= 9 && grid2[i][j] <= 16) || grid2[i][j] == 25) && signal[1]) || (grid2[i][j] >= 17 && grid2[i][j] <= 24 && signal[0])) {
grid[i][j] = 0;
} else {
if ((grid2[i][j] >= 9 && grid2[i][j] <= 12 && signal[0]) || (grid2[i][j] >= 17 && grid2[i][j] <= 20) && signal[1]) {
grid[i][j] += 4;
}

if ((grid2[i][j] >= 13 && grid2[i][j] <= 16 && !signal[0]) || (grid2[i][j] >= 21 && grid2[i][j] <= 24 && !signal[1])) {
grid[i][j] -= 4;
}
}

}

}
}
generation++;
genText.content = "Generation: " + generation;
}

function clearGrid() {
grid = Array(height).fill().map(e => Array(width).fill(0));
clearInterval(evolveInterval);
control.state = 0;
controlText.content = "Start";
generation = 0;
genText.content = "Generation: 0";
}

function onClick(event) {
updateGrid(event);

let object = {top: event.offsetY, bottom: event.offsetY, left:
event.offsetX, right: event.offsetX};

if (control.touching(object)) {
if (control.state == 0) {
evolveInterval = setInterval(evolve, 1000 / tickspeed);
control.state = 1;
controlText.content = "Stop";
} else if (control.state == 1) {
clearInterval(evolveInterval);
control.state = 0;
controlText.content = "Start";
}
}

if (clear.touching(object)) {
clearGrid();
}

if (step.touching(object)) {
evolve();
}

if (rand.touching(object)) {
generation = 0;
genText.content = "Generation: 0";
grid = Array(height).fill().map(e => Array(width).fill().map(e => Math.floor(Math.random() * states)));
}
}

canvas.addEventListener("mousedown", (event) => {
onClick(event);
canvas.addEventListener('mousemove', updateGrid);
});

canvas.addEventListener("mouseup", (event) => {
canvas.removeEventListener('mousemove', updateGrid);
clickedCell = [];
});

window.addEventListener("keydown", (event) => {
if (event.key == "=") {
cellType = cellType + 1 < states ? cellType + 1 : 1;
}
if (event.key == "-") {
cellType = cellType - 1 > 0 ? cellType - 1 : states - 1;
}
});
</script>

</body>
</html>
